create database DIALYVN
--DROP TABLE TINH_TP
use DIALYVN
go
create table TINH_TP
(
--TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN
	MA_T_TP VARCHAR (3) PRIMARY KEY,
	TEN_T_TP NVARCHAR (20),
	DT FLOAT,
	DS BIGINT,
	MIEN NVARCHAR (10)
)
go
CREATE TABLE BIENGIOI 
(
	NUOC NVARCHAR (15),
	MA_T_TP VARCHAR(3),
	PRIMARY KEY( MA_T_TP,NUOC) 
) 
go
ALTER TABLE BIENGIOI ADD FOREIGN KEY(MA_T_TP) REFERENCES TINH_TP(MA_T_TP)
go
CREATE TABLE LANGGIENG
(
	MA_T_TP VARCHAR(3) , 
	LG VARCHAR(3),
	PRIMARY KEY(MA_T_TP,LG)
)
go
ALTER TABLE LANGGIENG ADD FOREIGN KEY(MA_T_TP) REFERENCES TINH_TP(MA_T_TP)
go
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('AG',N'An Giang ',3406,2142709,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BR',N'Bà Rịa - Vũng Tàu',1982,996682,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BC',N'Bắc Cạn',4857,293826,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BG',N'Bắc Giang',3823,1554131,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BL',N'Bạc Liêu',2526,856518,	N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BN',N'Bắc Ninh',808,1024472,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BT',N'Bến Tre',2322,1255946,	N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BDI',N'Bình Định',6025,1486465,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BD',N'Bình Dương',2696,1481550,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BP',N'Bình Phước',6857,873598,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('BTH',N'Bình Thuận',7828,1167023,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('CM',N'Cà Mau',5202,1206938,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('CT',N'Cần Thơ',139,1188435,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('CB',N'Cao Bằng',6691,507183,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('DN',N'Đà Nẵng',1256,887435,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('DL',N'Đắc Lắc',13085,1733624,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('DNO',N'Đắc Nông',6515,489392,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('DB',N'Điện Biên',956,490306,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('DNA',N'Đồng Nai',5895,2486154,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('DT',N'Đồng Tháp',3246,1666467,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('GL',N'Gia Lai',15495,1274412,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HG',N'Hà Giang',7884,724537,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HNA',N'Hà Nam',852,784045,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HN',N'Hà Nội',3334.47,6451909,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HT',N'Hà Tây',2193,2047000,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HTI',N'Hà Tĩnh',6055.70,1227554,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HD',N'Hải Dương',1648,1705059,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HP',N'Hải Phòng',1526,1837173,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HAG',N'Hậu Giang',1608,757300,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HB',N'Hòa Bình',4663,785217,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HY',N'Hưng Yên',923,1127903,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('KH',N'Khánh Hòa',5198,1157604,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('KG',N'Kiên Giang',6268,1688248,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('KT',N'Kon Tum',9615,430133,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('LC',N'Lai Châu',9059,370502,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('LD',N'Lâm Đồng',9765,1187574,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('LS',N'Lạng Sơn',8305,732515,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('LCA','Lào Cai',6357,61.595,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('LA',N'Long An',4491,1436066,N'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('ND',N'Nam Định',1641,1828111,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('NA',N'Nghệ An',16487,3113055,N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('NB',N'Ninh Bình',1384,898999,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('NT',	N'Ninh Thuận', 3360,	564993,	N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('PT',	N'Phú Thọ', 3520,	1316389,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('PY',	N'Phú Yên', 5045,	862231,	N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('QB',	N'Quảng Bình',	805180,	846924,	N'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('QN',	N'Quảng Nam', 10407,1422319,'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('QNG',N'Quảng Ngãi', 5138,1216773,'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('QNI',N'Quảng Ninh', 5900,1144988,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('QT',	N'Quảng Trị',474570,597985,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('ST',	N'Sóc Trăng', 3223,	1292853,'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('SL',	N'Sơn La',14055,1076055,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TN',	N'Tây Ninh',4030,1066513,	'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TB',	N'Thái Bình',1545,	1781842,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TNG',N'Thái Nguyên', 3543,1123116,N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TH',	N'Thanh Hóa',11116,3400595,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TTH',N'Thừa Thiên Huế',505399,	1087579,'Trung')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TG',	N'Tiền Giang', 2367,1672271,'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('HCM',N'TP Hồ Chí Minh', 2095,7162864,'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TV',	N'Trà Vinh' ,2215,	1003012,'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('TQ',	N'Tuyên Quang', 5868,	724821,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('VL',	N'Vĩnh Long', 1475,	1024707,'Nam')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('VP',	N'Vĩnh Phúc', 1371,	999786,	N'Bắc')
INSERT INTO TINH_TP (MA_T_TP, TEN_T_TP, DT, DS, MIEN) VALUES ('YB',	N'Yên Bái', 6883,	740387,	N'Bắc')
go
-- Nhap du lieu bang LangGieng
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('AG','DT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('AG','KG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BR','HCM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BR','BTH')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BR','DNA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('DNA','BTH')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('DNA','BR')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('DNA','HCM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BD','TN')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BD','DNA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BD','BP')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BD','HCM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BP','BD')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BP','LD')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BP','DNA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BL','KG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BL','CT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BL','CM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BL','ST')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BT','TG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BT','VL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BT','TV')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BT','HCM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CM','KG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CM','BL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CT','AG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CT','DT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CT','VL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CT','KG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CT','BL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('CT','ST')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('DT','AG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('DT','LA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('DT','TG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HAG','CT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HAG','ST')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HAG','VL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HAG','KG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HAG','BL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('LA','TN')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('LA','TG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('LA','DT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('LA','HCM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HCM','BD')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HCM','TN')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HCM','DNA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HCM','BR')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HCM','LA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('HCM','TG')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TG','LA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TG','DT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TG','BT')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TG','VL')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TN','BD')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TN','BP')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TN','LA')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('TN','HCM')
INSERT INTO LANGGIENG (MA_T_TP,LG) VALUES ('BTH','DNA')
go
-- Nhap du lieu bang BienGioi
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','AG')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','DL')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','DT')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','GL')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','KG')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','LA')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','BP')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('CPC','TN')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('LAO','GL')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('LAO','LC')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('LAO','NT')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('LAO','BT')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('TQ','CB')
INSERT INTO BIENGIOI (NUOC,MA_T_TP) VALUES ('TQ','LC')

SELECT * FROM TINH_TP
SELECT * FROM LANGGIENG
SELECT * FROM BIENGIOI

--Câu 1: Xuất ra tên tỉnh, thành phố cùng với dân số của tỉnh, thành phố có diện tích >=5000 km2
select TEN_T_TP, DS
from TINH_TP
where DT>=5000

--Câu 2: Xuất ra tên tỉnh cùng với diện tích của tỉnh thuộc miền bắc
select TEN_T_TP, DT
from TINH_TP
where MIEN = N'Bắc'

--Câu 3: Xuất ra các Tên tỉnh, TP biên giới thuộc miền [input] (SV cho một miền bất kỳ)
select TEN_T_TP
from TINH_TP as tinh,BIENGIOI as biengioi
where tinh.MA_T_TP=biengioi.MA_T_TP
	and MIEN = N'Nam'

--Câu 4: Cho biết diện tích trung bình của các tỉnh, TP (Tổng DT/Tổng số tỉnh_TP).
select AVG(DT) as Diện_Tích_TB
from TINH_TP

--Câu 5:Cho biết mật độ dân số (DS/DT) cùng với tên tỉnh, TP của tất cả các tỉnh, TP.
select TEN_T_TP, DS/DT as Mật_Độ_DS
from TINH_TP

--Câu 6: Cho biết tên các tỉnh,TP láng giềng của tỉnh ‘Long An’.
select TEN_T_TP
from TINH_TP
where MA_T_TP in(
		select LG
		from LANGGIENG
		where MA_T_TP = 'LA'
)

--Câu 7: Cho biết số lượng các tỉnh, TP giáp với ‘CPC’.
select count(MA_T_TP) as SL
from BIENGIOI
where NUOC = 'CPC'

--Câu 8: Cho biết tên những tỉnh, TP có diện tích lớn nhất.
select TEN_T_TP
from TINH_TP
where DT = (select max(DT)
				from TINH_TP)

--Câu 9: Cho biết tỉnh, TP có mật độ DS đông nhất.
select TEN_T_TP 
from TINH_TP
where DS/DT=(select max(DS/DT)
				from TINH_TP
			)

--Câu 10: Cho biết tên những tỉnh, TP giáp với hai nước biên giới khác nhau.
select TEN_T_TP
from TINH_TP
where MA_T_TP in (
				select MA_T_TP
				from BIENGIOI
				group by  Ma_T_TP
				having count(MA_T_TP)=2
)

--Câu 11: Cho biết danh sách các miền cùng với các tỉnh, TP trong các miền đó.
select MIEN, TEN_T_TP
from TINH_TP
group by MIEN, TEN_T_TP

--Câu 12: Cho biết tên những tỉnh, TP có nhiều láng giềng nhất.
select TEN_T_TP
from TINH_TP
where MA_T_TP in (
	select MA_T_TP
	from LANGGIENG
	group by MA_T_TP
	having count(Ma_T_TP) >= all(
				select count(MA_T_TP) Dem
				from LANGGIENG
				group by MA_T_TP)
		)
--Câu 13: Cho biết những tỉnh, TP có diện tích nhỏ hơn diện tích trung bình của tất cả tỉnh, TP.
select TEN_T_TP
from TINH_TP
where DT > (select AVG(DT)
			from TINH_TP
			)
 
 --Câu 14: Cho biết tên những tỉnh, TP giáp với các tỉnh, TP ở miền ‘Nam’ và không phải là miền ‘Nam’.
select TEN_T_TP
from TINH_TP
where MIEN != N'Nam'
	and	MA_T_TP in(
				select LG
				from LANGGIENG
				where MA_T_TP in (select MA_T_TP
									from TINH_TP
									where MIEN = N'Nam')
								)

--Cách khác
select TEN_T_TP
from TINH_TP
where MIEN != N'Nam'
	and	MA_T_TP in(
				select LG
				from LANGGIENG, TINH_TP
				where LANGGIENG.MA_T_TP=TINH_TP.MA_T_TP
					and MIEN = N'Nam'
					)

--Thông tin tỉnh, thành phố
SELECT * FROM TINH_TP
SELECT * FROM LANGGIENG
SELECT * FROM BIENGIOI
